<!doctype html><html lang=es class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="HackLab Almeria - Taller de Juegos Retro con Mega Drive"><link href=https://zerasul.github.io/taller-megadrive/devretro/controls/ rel=canonical><meta name=author content="Victor Suarez Garcia"><meta name=lang:clipboard.copy content="Copiar al portapapeles"><meta name=lang:clipboard.copied content="Copiado al portapapeles"><meta name=lang:search.language content=es><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No se encontraron documentos"><meta name=lang:search.result.one content="1 documento encontrado"><meta name=lang:search.result.other content="# documentos encontrados"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=https://hacklabalmeria.net/recursos/favicons/favicon-32x32.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Controles - Taller de Desarrollo de Juegos Retro con MegaDrive</title><link rel=stylesheet href=../../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=blue-orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#controles-en-mega-drive tabindex=1 class=md-skip> Saltar a contenido </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://zerasul.github.io/taller-megadrive/ title="Taller de Desarrollo de Juegos Retro con MegaDrive" class="md-header-nav__button md-logo"> <img src=https://hacklabalmeria.net/recursos/favicons/apple-icon-152x152.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Taller de Desarrollo de Juegos Retro con MegaDrive </span> <span class=md-header-nav__topic> Controles </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Búsqueda autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Teclee para comenzar búsqueda </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/zerasul/taller-megadrive title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> zerasul/taller-megadrive </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://zerasul.github.io/taller-megadrive/ title="Taller de Desarrollo de Juegos Retro con MegaDrive" class="md-nav__button md-logo"> <img src=https://hacklabalmeria.net/recursos/favicons/apple-icon-152x152.png width=48 height=48> </a> Taller de Desarrollo de Juegos Retro con MegaDrive </label> <div class=md-nav__source> <a href=https://github.com/zerasul/taller-megadrive title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> zerasul/taller-megadrive </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Introducción class=md-nav__link> Introducción </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Historia </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Historia </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../history/history/ title="Historia de la Mega Drive" class=md-nav__link> Historia de la Mega Drive </a> </li> <li class=md-nav__item> <a href=../../history/m68k/ title="Desarrollo en Motorola 68000" class=md-nav__link> Desarrollo en Motorola 68000 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> SGDK; Sega Genesis Development Kit </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> SGDK; Sega Genesis Development Kit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sgdk/sgdk/ title=SGDK class=md-nav__link> SGDK </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Instalación Entorno </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Instalación Entorno </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sgdk/instalacion/windows/ title=Windows class=md-nav__link> Windows </a> </li> <li class=md-nav__item> <a href=../../sgdk/instalacion/linux/ title=Linux class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../sgdk/instalacion/macos/ title="Mac OS" class=md-nav__link> Mac OS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../sgdk/gens/ title="Gens Emulador" class=md-nav__link> Gens Emulador </a> </li> <li class=md-nav__item> <a href=../../sgdk/vscode/ title="VS Code" class=md-nav__link> VS Code </a> </li> <li class=md-nav__item> <a href=../../sgdk/hola-mundo/ title="Hola Mundo" class=md-nav__link> Hola Mundo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Desarrollo de Juegos Retro </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Desarrollo de Juegos Retro </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Controles </label> <a href=./ title=Controles class="md-nav__link md-nav__link--active"> Controles </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#controles-sincronos title="Controles Síncronos" class=md-nav__link> Controles Síncronos </a> </li> <li class=md-nav__item> <a href=#controles-asincronos title="Controles Asincronos" class=md-nav__link> Controles Asincronos </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../planes/ title=Planos class=md-nav__link> Planos </a> </li> <li class=md-nav__item> <a href=../sprites/ title=Sprites class=md-nav__link> Sprites </a> </li> <li class=md-nav__item> <a href=../sound-music/ title="Musica y sonido" class=md-nav__link> Musica y sonido </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../references/ title=Referencias class=md-nav__link> Referencias </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#controles-sincronos title="Controles Síncronos" class=md-nav__link> Controles Síncronos </a> </li> <li class=md-nav__item> <a href=#controles-asincronos title="Controles Asincronos" class=md-nav__link> Controles Asincronos </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=controles-en-mega-drive>Controles en Mega Drive<a class=headerlink href=#controles-en-mega-drive title="Permanent link">&para;</a></h1> <p>A la hora de trabajar con los controles de mega Drive, hay que tener en cuenta que había varios perifericos especiales para esta videoconsola. Como puede ser un <a href=http://museodelvideojuego.com/accesorios/sega-mouse>segamouse</a>; o tener un adaptador para más de 2 controladores (como podía ser los juegos con formato J-Cart).</p> <p><img alt=Micro-Machines2 src=https://upload.wikimedia.org/wikipedia/commons/e/e6/Mega_drive_j-cart.jpg></p> <p>Es por ello que necesitamos conocer la manera de poder leer la entrada de los controles para poder hacer que el juego sea más interactivo; en el caso de usar SGDK, podemos hacerlo de forma síncrona o asíncrona. Comenzaremos con la forma Síncrona.</p> <h2 id=controles-sincronos>Controles Síncronos<a class=headerlink href=#controles-sincronos title="Permanent link">&para;</a></h2> <p>Como vimos en el apartado del <a href=../../sgdk/hola-mundo/ >hola mundo</a>, vamos a crear una nueva carpeta que contenga otra carpeta llamda <em>src</em> y en este caso, otra llamada <em>inc</em>; quedando el arbol de ficheros así:</p> <div class=codehilite><pre><span></span>miproyecto
    <span class=p>|</span>
    ______src/
    ______inc/
</pre></div> <p>Una vez creadas las carpetas, crearemos un fichero llamado <em>main.c</em> que deberá estar incluido dentro de la carpeta src. que tendrá el siguiente contenido:</p> <div class=codehilite><pre><span></span><span class=cm>/* Ejemplo 2: Controles. Este ejemplo permite ver como leer de forma sincrona los controles de la megaDrive */</span>
<span class=cp>#include</span> <span class=cpf>&lt;genesis.h&gt;</span><span class=cp></span>
<span class=c1>//Se inclue el fichero de constantes que hemos definido y debe ir en la carpeta inc</span>
<span class=cp>#include</span> <span class=cpf>&quot;constants.h&quot;</span><span class=cp></span>

<span class=c1>//Definicion de la funcion ShowInputStatus; mostrara en pantalla cuando se pulse un boton</span>
<span class=kt>void</span> <span class=nf>showInputStatus</span><span class=p>();</span>
<span class=c1>//Imprime un caracter en una posicion especifica</span>
<span class=kt>void</span> <span class=nf>printChar</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=c1>//Se establece el ancho de pantalla a 320</span>
    <span class=n>VDP_setScreenWidth320</span><span class=p>();</span>
    <span class=c1>//Bucle infinito</span>
    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=c1>//Se muestra el estado por pantalla</span>
        <span class=n>showInputStatus</span><span class=p>();</span>
        <span class=c1>//Se espera al refresco de pantalla</span>
        <span class=n>VDP_waitVSync</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=p>(</span><span class=mi>0</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * Imprime por pantalla un texto en una posicion en Tiles</span>
<span class=cm> * text-&gt; Cadena de texto a imprimir</span>
<span class=cm> * posx-&gt; Posicion X en Tiles (1Tile = 8X8 pixels)</span>
<span class=cm> * posy -&gt; Posicion Y en Tiles (1 Tile = 8x8 Pixels)</span>
<span class=cm> * */</span>
<span class=kt>void</span> <span class=nf>printChar</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>text</span><span class=p>,</span> <span class=kt>int</span> <span class=n>posx</span><span class=p>,</span> <span class=kt>int</span> <span class=n>posy</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>VDP_drawText</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>posx</span><span class=p>,</span> <span class=n>posy</span><span class=p>);</span>
<span class=p>}</span>
<span class=cm>/**</span>
<span class=cm> * Muestra por pantalla el estado de cada boton pulsado.</span>
<span class=cm> * */</span>
<span class=kt>void</span> <span class=nf>showInputStatus</span><span class=p>()</span>
<span class=p>{</span>
    <span class=c1>//Se lee el estado del joistick en el puerto 1</span>
    <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=n>JOY_readJoypad</span><span class=p>(</span><span class=n>JOY_1</span><span class=p>);</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_UP</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>UP_TEXT</span><span class=p>,</span> <span class=n>POSX_UP</span><span class=p>,</span> <span class=n>POSY_UP</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_UP</span><span class=p>,</span> <span class=n>POSY_UP</span><span class=p>);</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_LEFT</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>LEFT_TEXT</span><span class=p>,</span> <span class=n>POSX_LEFT</span><span class=p>,</span> <span class=n>POSY_LEFT</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_LEFT</span><span class=p>,</span> <span class=n>POSY_LEFT</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_RIGHT</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>RIGTH_TEXT</span><span class=p>,</span> <span class=n>POSX_RIGHT</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_RIGHT</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
    <span class=k>if</span><span class=p>(</span> <span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_DOWN</span><span class=p>)</span>
         <span class=n>printChar</span><span class=p>(</span><span class=n>DOWN_TEXT</span><span class=p>,</span> <span class=n>POSX_DOWN</span><span class=p>,</span> <span class=n>POSY_DOWN</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_DOWN</span><span class=p>,</span> <span class=n>POSY_DOWN</span><span class=p>);</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_A</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>A_TEXT</span><span class=p>,</span> <span class=n>POSX_A</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_A</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_B</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>B_TEXT</span><span class=p>,</span> <span class=n>POSX_B</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_B</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_C</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>C_TEXT</span><span class=p>,</span> <span class=n>POSX_C</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_C</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_START</span><span class=p>)</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>START_TEXT</span><span class=p>,</span> <span class=n>POSX_START</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
    <span class=k>else</span>
        <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_START</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> <p>Como podéis ver en el ejemplo, nos falta un fichero donde se encuentran todas las constantes que hemos definido; el cual podéis descargar <a href=../../res/constants.h>aquí</a> y ponerlo en la carpeta <em>inc</em>. Una vez los dos ficheros esten listos, podemos compilarlo y ejecutarlo en un emulador o consola.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><strong>Recuerda</strong>: La rom compilada se encuentra en la carpeta <em>out</em> con el nombre <em>rom.bin</em>.</p> </div> <p>Si ejecutamos usando un emulador la rom este sería el aspecto:</p> <p><img alt=controlesroms src=../../img/controlesrom.PNG></p> <h2 id=controles-asincronos>Controles Asincronos<a class=headerlink href=#controles-asincronos title="Permanent link">&para;</a></h2> <p>La forma anterior, es quizas menos eficiente ya que debemos esperar a que termine de dibujar toda la pantalla para poder leer de nuevo los controles. Es por ello que se requiere una forma asíncrona que utilice la potencia de las interrupciones para poder ejecutar la lectura de los controles "Cuando sea necesario".</p> <p>Vamos a crear otro proyecto con la misma estructura anterior; (No olvides incluir el fichero .h). En este caso usaremos el siguiente código fuente en el fichero <em>main.c</em>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><strong>Recuerda</strong>: Todos los ejemplos estaran disponible en el repositorio de este taller.</p> </div> <p>Seguidamente mostramos el código fuente:</p> <div class=codehilite><pre><span></span><span class=cm>/* Ejemplo 4: Controles Asincronos. Uso de interrupciones para manejar controles.</span>
<span class=cm>*/</span>
<span class=cp>#include</span> <span class=cpf>&lt;genesis.h&gt;</span><span class=cp></span>
<span class=c1>//Libreria de constantes</span>
<span class=cp>#include</span> <span class=cpf>&quot;constants.h&quot;</span><span class=cp></span>
<span class=c1>//Manejador de entrada</span>
<span class=kt>void</span> <span class=nf>inputHandler</span><span class=p>(</span><span class=n>u16</span><span class=p>,</span><span class=n>u16</span><span class=p>,</span><span class=n>u16</span><span class=p>);</span>
<span class=c1>//Imprime un mensaje en pantalla</span>
<span class=kt>void</span> <span class=nf>printChar</span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
<span class=c1>//Funcion principal</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=c1>//inicializacion del sistema de controles</span>
    <span class=n>JOY_init</span><span class=p>();</span>
    <span class=c1>//Establecemos el manejador de entrada</span>
    <span class=n>JOY_setEventHandler</span><span class=p>(</span> <span class=o>&amp;</span><span class=n>inputHandler</span> <span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>VDP_waitVSync</span><span class=p>();</span>

    <span class=p>}</span>
    <span class=k>return</span> <span class=p>(</span><span class=mi>0</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * Imprime por pantalla un texto en una posicion en Tiles</span>
<span class=cm> * text-&gt; Cadena de texto a imprimir</span>
<span class=cm> * posx-&gt; Posicion X en Tiles (1Tile = 8X8 pixels)</span>
<span class=cm> * posy -&gt; Posicion Y en Tiles (1 Tile = 8x8 Pixels)</span>
<span class=cm> * */</span>
<span class=kt>void</span> <span class=nf>printChar</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>text</span><span class=p>,</span> <span class=kt>int</span> <span class=n>posx</span><span class=p>,</span> <span class=kt>int</span> <span class=n>posy</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>VDP_drawText</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>posx</span><span class=p>,</span> <span class=n>posy</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * Manejador de entrada</span>
<span class=cm> * joy-&gt; Indica el mando que ha activado la entrada</span>
<span class=cm> * state -&gt; Indica el estado del mando (boton activado)</span>
<span class=cm> * changed -&gt; indica si ha cambiado (pulsado o solatado)</span>
<span class=cm> * */</span>
<span class=kt>void</span> <span class=nf>inputHandler</span><span class=p>(</span><span class=n>u16</span> <span class=n>joy</span><span class=p>,</span> <span class=n>u16</span> <span class=n>state</span><span class=p>,</span> <span class=n>u16</span> <span class=n>changed</span><span class=p>)</span>
<span class=p>{</span>


        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_START</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>START_TEXT</span><span class=p>,</span> <span class=n>POSX_START</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_START</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>  
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_UP</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>UP_TEXT</span><span class=p>,</span> <span class=n>POSX_UP</span><span class=p>,</span> <span class=n>POSY_UP</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_UP</span><span class=p>,</span> <span class=n>POSY_UP</span><span class=p>);</span>    
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_LEFT</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>LEFT_TEXT</span><span class=p>,</span> <span class=n>POSX_LEFT</span><span class=p>,</span> <span class=n>POSY_LEFT</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_LEFT</span><span class=p>,</span> <span class=n>POSY_LEFT</span><span class=p>);</span>    
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_DOWN</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>DOWN_TEXT</span><span class=p>,</span> <span class=n>POSX_DOWN</span><span class=p>,</span> <span class=n>POSY_DOWN</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_DOWN</span><span class=p>,</span> <span class=n>POSY_DOWN</span><span class=p>);</span>    
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_RIGHT</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>RIGTH_TEXT</span><span class=p>,</span> <span class=n>POSX_RIGHT</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_RIGHT</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>  
        <span class=p>}</span>


        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_A</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>A_TEXT</span><span class=p>,</span> <span class=n>POSX_A</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_A</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>  
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_B</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>B_TEXT</span><span class=p>,</span> <span class=n>POSX_B</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_B</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>  
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>changed</span> <span class=o>&amp;</span> <span class=n>state</span> <span class=o>&amp;</span> <span class=n>BUTTON_C</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>C_TEXT</span><span class=p>,</span> <span class=n>POSX_C</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>else</span> 
        <span class=p>{</span>
            <span class=n>printChar</span><span class=p>(</span><span class=n>EMPTY_TEXT</span><span class=p>,</span> <span class=n>POSX_C</span><span class=p>,</span> <span class=n>POSY_RIGHT</span><span class=p>);</span>  
        <span class=p>}</span>

<span class=p>}</span>
</pre></div> <p>Una vez que hemos visto como funcionan los controles, pasaremos a ver como funcionan los planos y como podemos añadir recursos a nuestros proyectos.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../sgdk/hola-mundo/ title="Hola Mundo" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Anterior </span> Hola Mundo </span> </div> </a> <a href=../planes/ title=Planos class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Siguiente </span> Planos </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 <a href=https://twitter.com/zerasul>Zerasul</a> <img alt="Licencia de Creative Commons" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/80x15.png> </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/HackLab-Almeria class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/HackLabAl class="md-footer-social__link fa fa-twitter"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.245445c6.js></script> <script src=../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../assets/javascripts/lunr/lunr.es.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>