<!doctype html><html lang=es class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="HackLab Almeria - Taller de Juegos Retro con Mega Drive"><link href=https://zerasul.github.io/taller-megadrive/devretro/sprites/ rel=canonical><meta name=author content="Victor Suarez Garcia"><meta name=lang:clipboard.copy content="Copiar al portapapeles"><meta name=lang:clipboard.copied content="Copiado al portapapeles"><meta name=lang:search.language content=es><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No se encontraron documentos"><meta name=lang:search.result.one content="1 documento encontrado"><meta name=lang:search.result.other content="# documentos encontrados"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=https://hacklabalmeria.net/recursos/favicons/favicon-32x32.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Sprites - Taller de Desarrollo de Juegos Retro con MegaDrive</title><link rel=stylesheet href=../../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=blue-orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#sprites tabindex=1 class=md-skip> Saltar a contenido </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://zerasul.github.io/taller-megadrive/ title="Taller de Desarrollo de Juegos Retro con MegaDrive" class="md-header-nav__button md-logo"> <img src=https://hacklabalmeria.net/recursos/favicons/apple-icon-152x152.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Taller de Desarrollo de Juegos Retro con MegaDrive </span> <span class=md-header-nav__topic> Sprites </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Búsqueda autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Teclee para comenzar búsqueda </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/zerasul/taller-megadrive title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> zerasul/taller-megadrive </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://zerasul.github.io/taller-megadrive/ title="Taller de Desarrollo de Juegos Retro con MegaDrive" class="md-nav__button md-logo"> <img src=https://hacklabalmeria.net/recursos/favicons/apple-icon-152x152.png width=48 height=48> </a> Taller de Desarrollo de Juegos Retro con MegaDrive </label> <div class=md-nav__source> <a href=https://github.com/zerasul/taller-megadrive title="Ir al repositorio" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> zerasul/taller-megadrive </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Introducción class=md-nav__link> Introducción </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Historia </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Historia </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../history/history/ title="Historia de la Mega Drive" class=md-nav__link> Historia de la Mega Drive </a> </li> <li class=md-nav__item> <a href=../../history/m68k/ title="Desarrollo en Motorola 68000" class=md-nav__link> Desarrollo en Motorola 68000 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> SGDK; Sega Genesis Development Kit </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> SGDK; Sega Genesis Development Kit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sgdk/sgdk/ title=SGDK class=md-nav__link> SGDK </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Instalación Entorno </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Instalación Entorno </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sgdk/instalacion/windows/ title=Windows class=md-nav__link> Windows </a> </li> <li class=md-nav__item> <a href=../../sgdk/instalacion/linux/ title=Linux class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../sgdk/instalacion/macos/ title="Mac OS" class=md-nav__link> Mac OS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../sgdk/gens/ title="Gens Emulador" class=md-nav__link> Gens Emulador </a> </li> <li class=md-nav__item> <a href=../../sgdk/vscode/ title="VS Code" class=md-nav__link> VS Code </a> </li> <li class=md-nav__item> <a href=../../sgdk/hola-mundo/ title="Hola Mundo" class=md-nav__link> Hola Mundo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Desarrollo de Juegos Retro </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Desarrollo de Juegos Retro </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../controls/ title=Controles class=md-nav__link> Controles </a> </li> <li class=md-nav__item> <a href=../planes/ title=Planos class=md-nav__link> Planos </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Sprites </label> <a href=./ title=Sprites class="md-nav__link md-nav__link--active"> Sprites </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#anadir-sprites-en-sgdk title="Añadir Sprites en SGDK" class=md-nav__link> Añadir Sprites en SGDK </a> </li> <li class=md-nav__item> <a href=#matematicas-y-fisica-en-sgdk title="Matemáticas y Física en SGDK" class=md-nav__link> Matemáticas y Física en SGDK </a> </li> <li class=md-nav__item> <a href=#animaciones-en-sgdk title="Animaciones en SGDK" class=md-nav__link> Animaciones en SGDK </a> </li> <li class=md-nav__item> <a href=#plano-de-los-sprites title="Plano de los Sprites" class=md-nav__link> Plano de los Sprites </a> </li> <li class=md-nav__item> <a href=#ejemplo-con-sprites title="Ejemplo con Sprites" class=md-nav__link> Ejemplo con Sprites </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../sound-music/ title="Musica y sonido" class=md-nav__link> Musica y sonido </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../references/ title=Referencias class=md-nav__link> Referencias </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Tabla de contenidos</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#anadir-sprites-en-sgdk title="Añadir Sprites en SGDK" class=md-nav__link> Añadir Sprites en SGDK </a> </li> <li class=md-nav__item> <a href=#matematicas-y-fisica-en-sgdk title="Matemáticas y Física en SGDK" class=md-nav__link> Matemáticas y Física en SGDK </a> </li> <li class=md-nav__item> <a href=#animaciones-en-sgdk title="Animaciones en SGDK" class=md-nav__link> Animaciones en SGDK </a> </li> <li class=md-nav__item> <a href=#plano-de-los-sprites title="Plano de los Sprites" class=md-nav__link> Plano de los Sprites </a> </li> <li class=md-nav__item> <a href=#ejemplo-con-sprites title="Ejemplo con Sprites" class=md-nav__link> Ejemplo con Sprites </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=sprites>Sprites<a class=headerlink href=#sprites title="Permanent link">&para;</a></h1> <p>Un Sprite, es un mapa de bits que va a ser representado en una pantalla de ordenador con un hardware especifico sin necesidad de calculos adicionales de CPU. Normalmente se asocia un sprite a un objeto a representar en un videojuego; como puede ser el jugador o cualquier enemigo.</p> <p>Normalmente un sprite se compone de una serie de imagenes que representan distintos frames a representar en la pantalla; cada frame se representará en un orden especifico para así formar una animación.</p> <p><img alt=ejemplosprites src=../../img/ejemplosprites.png></p> <p>Como se ve en la anterior imagen, este sprites se compone de una serie de imagenes que cada linea corresponde a una animación; esto es importante cuando lleguemos a la parte de generar animaciones. </p> <p>Sin embargo, antes de continuar tenemos que tener en cuenta como funcionan los sprites dentro de la MegaDrive.</p> <ul> <li>Los sprites tienen su propio plano.</li> <li>La posicion de pantalla de los Sprites van en Píxeles y no en Tiles.</li> <li>Podemos tener un total de 80 sprites por pantalla.</li> <li>Solo se pueden tener 20 sprites por linea horizontal.</li> <li>La manera de cargar un sprite es igual que los Planos (en pixels).</li> <li>Un sprites siempre debe ser divisible por 8 ya que de otra forma no se podría cargar.</li> <li>El tamaño máximo de un sprites que SGDK permite manejar es de 16x16 tiles (128x128 píxeles).</li> </ul> <h2 id=anadir-sprites-en-sgdk>Añadir Sprites en SGDK<a class=headerlink href=#anadir-sprites-en-sgdk title="Permanent link">&para;</a></h2> <p>Como hemos comentado, para cargar los sprites se hacen de igual forma que para los planos; sin embargo, tenemos que tener en cuenta una serie de cambios. Como por ejemplo como se añade el fichero de recuros (.res).</p> <p>Como con los planos, se debe crear un fichero para añadir los recursos; por lo que se añadira un fichero con extensión <em>.res</em>, con la siguiente información:</p> <div class=codehilite><pre><span></span><span class=n>SPRITE</span> <span class=n>nombre_variable</span> <span class=s2>&quot;misprite.png&quot;</span> <span class=n>tiles_ancho</span> <span class=n>tiles_alto</span> <span class=n>FAST</span> <span class=n>veloc_ani</span>
</pre></div> <p>Donde:</p> <ul> <li>SPRITE: indica el tipo de recurso</li> <li>nombre_variable: Nombre de la variable para referenciarlo en el código.</li> <li>ruta del recurso: Ruta relativa donde se encuentra el recurso.</li> <li>tiles_ancho: Número de tiles de cada frame de ancho.</li> <li>tiles_alto: Número de tiles de cada frame de alto.</li> <li>compresión: Indica la compresión usada para añadir el recurso. En este caso es FAST, pero puede ser NONE.</li> <li>veloc_ani: Velocidad de la animación. Tiempo entre cada frame.</li> <li>collision (a partir de SGDK 1.41): Indica la caja de colision a utilizar (CIRCLE (circular), BOX (caja) o NONE (ninguna)).</li> </ul> <p>Una vez añadido el fichero, compilaremos nuestro proyecto, y se generará un fichero .h en la carpeta <em>res</em>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Si queremos que se vuelvan a generar de nuevo los recursos, podemos hacerlo ejecutando el comando make y añadiendo la opción <code class=codehilite><span class=err>clean</span></code>.</p> </div> <p>Con este fichero .h ya podemos añadirlo a nuestro código como hemos hecho para los planos:</p> <div class=codehilite><pre><span></span><span class=cp>#include</span> <span class=cpf>&quot;sprites.h&quot;</span><span class=cp></span>
</pre></div> <p>Una vez hecho esto, tenemos en nuestro código inicializar el motor de Sprites para poder utilizarlos. Para ello, usaremos la función <code class=codehilite><span class=err>SPR_init</span></code>.</p> <p>Ejemplo:</p> <div class=codehilite><pre><span></span><span class=n>SPR_init</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span><span class=c1>//Normalmente se deja a 0 para que tome los valores por defecto.</span>
</pre></div> <p>Una vez inicializado, añadiremos el sprite (podemos añadir a partir de una definición de Sprites, varios de ellos).</p> <div class=codehilite><pre><span></span><span class=n>Sprite</span><span class=o>*</span> <span class=n>mainsprt</span> <span class=o>=</span> <span class=n>SPR_addSprite</span><span class=p>(</span><span class=o>&amp;</span><span class=n>main_sprt</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>125</span><span class=p>,</span> <span class=n>TILE_ATTR_FULL</span><span class=p>(</span><span class=n>PAL2</span><span class=p>,</span> <span class=n>TRUE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span><span class=n>ind</span><span class=p>));</span>
</pre></div> <p>Por último es importante que se actualicen los sprites en cada frame por lo que necesitaremos la función <code class=codehilite><span class=err>SPR_update()</span></code>, sea llamada en cada frame.</p> <p>Ejemplo:</p> <div class=codehilite><pre><span></span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>SPR_update</span><span class=p>();</span>
    <span class=n>VDP_waitVSync</span><span class=p>();</span>
<span class=p>}</span>
</pre></div> <h2 id=matematicas-y-fisica-en-sgdk>Matemáticas y Física en SGDK<a class=headerlink href=#matematicas-y-fisica-en-sgdk title="Permanent link">&para;</a></h2> <p>Antes de continuar con las animaciones de los Sprites y como manejarlos en SGDK, vamos a ver un poco de como manejar las matemáticas y física en MegaDrive; ya que el procesador Motorola 68000 no tiene soporte para coma flotante; esto quiere decir que no podemos usar decimales y todos los calculos son enteros.</p> <p>Es por ello, que necesitaremos una serie de tipo de datos para poder trabajar con decimales; por lo que SGDK nos define los siguientes datos:</p> <table> <thead> <tr> <th>Tipo</th> <th>Nº Bits (signo, entero, decimal)</th> <th>Rango</th> </tr> </thead> <tbody> <tr> <td>fix16</td> <td>16 (1, 9, 6)</td> <td>-512.00 a 511.00</td> </tr> <tr> <td>fix32</td> <td>32 (1,21,10)</td> <td>- 2097152.000 a 2097151.000</td> </tr> </tbody> </table> <p>Seguidamente dejamos una serie de Funciones de utilidad para trabajar con este tipo de datos:</p> <table> <thead> <tr> <th>Funciones</th> <th>Descripción</th> <th>Ejemplo</th> </tr> </thead> <tbody> <tr> <td>FIX16(nº)</td> <td>Declara un nuevo Fix16 a partir de un número</td> <td><code class=codehilite><span class=err>FIX16(10.5);</span></code></td> </tr> <tr> <td>FIX32(nº)</td> <td>Declara un nuevo Fix32 a partir de un número</td> <td><code class=codehilite><span class=err>FIX32(3456.00);</span></code></td> </tr> <tr> <td>intToFix16(nº)</td> <td>Convierte un entero a fix16</td> <td><code class=codehilite><span class=err>intToFix16(value_s16);</span></code></td> </tr> <tr> <td>intToFix32(nº)</td> <td>Convierte un entero a fix32</td> <td><code class=codehilite><span class=err>intToFix32(value_s32);</span></code></td> </tr> <tr> <td>fix16ToInt(nº)</td> <td>Convierte un fix16 a entero (truncando)</td> <td><code class=codehilite><span class=err>fix16ToInt(value_fix16);</span></code></td> </tr> <tr> <td>fix32ToInt(nº)</td> <td>Convierte un fix32 a entero(truncando)</td> <td><code class=codehilite><span class=err>fix32Toint(value_fix32);</span></code></td> </tr> <tr> <td>fix16ToRoundedInt(nº)</td> <td>Convierte un fix16 a entero por redondeo</td> <td><code class=codehilite><span class=err>fix16ToRoundedInt(value_fix16);</span></code></td> </tr> <tr> <td>fix32ToRoundedInt(nº)</td> <td>Convierte un fix32 a entero por redondeo</td> <td><code class=codehilite><span class=err>fix32ToRoundedInt(value_fix32);</span></code></td> </tr> <tr> <td>fix16Add(a,b)</td> <td>Realiza la suma de dos fix16.</td> <td><code class=codehilite><span class=err>fix16Add(a,b);</span></code></td> </tr> <tr> <td>fix32Add(a,b)</td> <td>Realiza la suma de dos fix32</td> <td><code class=codehilite><span class=err>fix32Add(a,b);</span></code></td> </tr> <tr> <td>fix16Sub(a,b)</td> <td>Realiza la resta de dos fix16</td> <td><code class=codehilite><span class=err>fix16Sub(a,b);</span></code></td> </tr> <tr> <td>fix32Sub(a,b)</td> <td>Realiza la resta de dos fix32</td> <td><code class=codehilite><span class=err>fix32Sub(a,b);</span></code></td> </tr> <tr> <td>fix16Mul(a,b)</td> <td>Realiza el producto de dos fix16</td> <td><code class=codehilite><span class=err>fix16Mul(a,b);</span></code></td> </tr> <tr> <td>fix32Mul(a,b)</td> <td>Realiza el producto de dos fix32</td> <td><code class=codehilite><span class=err>fix32Mul(a,b);</span></code></td> </tr> <tr> <td>fix16sqrt(a)</td> <td>Realiza la raiz cuardara de un fix16</td> <td><code class=codehilite><span class=err>fix16sqrt(value_fix16);</span></code></td> </tr> <tr> <td>fix32sqrt(a)</td> <td>Realiza la raiz cuadrada de un fix32</td> <td><code class=codehilite><span class=err>fixsqrt(value_fix32);</span></code></td> </tr> <tr> <td>sinFix16(v)</td> <td>Realiza el seno del angulo en radianes representado en el rango de 0 a 1024</td> <td><code class=codehilite><span class=err>sinFix16(FIX16(256.00));</span></code></td> </tr> <tr> <td>cosFix32(v)</td> <td>Realiza el coseno del angulo en radianes representado en el rango de 0 a 1024</td> <td><code class=codehilite><span class=err>cosFix32(FIX32(512));</span></code></td> </tr> </tbody> </table> <h2 id=animaciones-en-sgdk>Animaciones en SGDK<a class=headerlink href=#animaciones-en-sgdk title="Permanent link">&para;</a></h2> <p>Tras conocer ya como trabajar con las matemáticas y física con SGDK, vamos a pasar a hablar de las animaciones. Como hemos contando antes, un sprite se compone de una serie de frames que nos permitirán hacer animaciones.</p> <p>Para realizar animaciones, necesitamos que cada una de ellas se encuentre en una linea (andar derecha, andar izquierda, atarcar,etc..), SGDK permite hasta 16 animaciones por sprite. Es importante conocer como esta compuesto nuestro sprite y saber de cuanto es cada frame (en tiles); esto lo hemos visto a la hora de añadir sprites a nuestro proyecto.</p> <p>vamos a mostrar una imagen de prueba:</p> <p><img alt=animacionsprite src=../../img/ellibaston.png></p> <p>Como vemos este sprite se compone de 4 filas de 3 frames cada una; si mostraramos la ejecución de cada una se vería la siguiente ejecución:</p> <p><img alt=animacion src=../../img/animacion.gif></p> <p>En cada momento podemos cambiar la animación de nuestro sprite con la función <code class=codehilite><span class=err>SPR_setAnim(sprite, nº animacion)</span></code>; esta función debe ser llamada antes de actualizar el motor de sprites. Es importante saber, que cada fila representa una animación y que empieza por 0.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Siempre recomendamos usar constantes para definir nuestras animaciones.</p> </div> <h2 id=plano-de-los-sprites>Plano de los Sprites<a class=headerlink href=#plano-de-los-sprites title="Permanent link">&para;</a></h2> <p>Al igual que con los planos, los sprites tienen su propio plano en que se dibujaran; sin embargo, también disponen de prioridad y permite poder tener sensación de profundidad.</p> <p><img alt=ordenplanos src=../../img/esquemaplanos.png></p> <p>Podemos cambiar la prioridad del sprite con la función <code class=codehilite><span class=err>SPR_setPriorityAttribut(sprite, TRUE| FALSE)</span></code>; la cual podemos definir si el sprite tiene prioridad o no.</p> <h2 id=ejemplo-con-sprites>Ejemplo con Sprites<a class=headerlink href=#ejemplo-con-sprites title="Permanent link">&para;</a></h2> <p>Por último, vamos a hacer un pequeño ejemplo con Sprites donde mostraremos 2 sprites que dejamos las imagenes a continuación:</p> <p><img alt=elliready src=../../img/elliready.png> <img alt=zeraready src=../../img/zeraready.png></p> <p><a href=../../res/sprites.zip>Enlace descarga imagenes</a></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>La imagen del personaje con sombrero es de 16x16 pixeles cada frame mientras que el personaje con coletas es de 32x32 cada frame.</p> </div> <p>Una vez descargas las imagenes y añadidas al proyecto, crearemos el código fuente:</p> <div class=codehilite><pre><span></span><span class=cm>/** Ejemplo5: Ejemplo de planos con Mega Drive **/</span>
<span class=c1>//Incluir libreria</span>
<span class=cp>#include</span> <span class=cpf>&lt;genesis.h&gt;</span><span class=cp></span>

<span class=c1>// Incluir los recursos</span>
<span class=cp>#include</span> <span class=cpf>&quot;gfx.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;sprt.h&quot;</span><span class=cp></span>

<span class=c1>//animaciones</span>
<span class=cp>#define ANIM_RIGTH 1</span>
<span class=cp>#define ANIM_LEFT 3</span>
<span class=cp>#define ANIM_DOWN 2</span>
<span class=cp>#define ANIM_UP 0</span>
<span class=cp>#define ANIM_STAY 4</span>

<span class=c1>//Esta funcion nos ayudara a leer los controles</span>
<span class=kt>void</span> <span class=nf>readcontrollers</span><span class=p>();</span>

<span class=c1>//Sprite Principal</span>
<span class=n>Sprite</span><span class=o>*</span> <span class=n>mainsprt</span><span class=p>;</span>
<span class=c1>//Sprite Secundario</span>
<span class=n>Sprite</span><span class=o>*</span> <span class=n>secondsprt</span><span class=p>;</span>
<span class=n>u32</span> <span class=n>posx</span> <span class=o>=</span> <span class=mi>45</span><span class=p>;</span>
<span class=n>u32</span> <span class=n>posy</span> <span class=o>=</span> <span class=mi>155</span><span class=p>;</span>
<span class=c1>//Funcion Principal</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=c1>//array donde se almacenara las paletas</span>
    <span class=n>u16</span> <span class=n>palette</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span>



   <span class=c1>//Para evitar problemas, se deshabilitan las interrupciones durante la carga</span>
    <span class=n>SYS_disableInts</span><span class=p>();</span>
    <span class=c1>// initializacion a 320 de ancho</span>
    <span class=n>VDP_setScreenWidth320</span><span class=p>();</span>

     <span class=c1>// se establecen los colores de la paleta a negro</span>
    <span class=n>VDP_setPaletteColors</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>(</span><span class=n>u16</span><span class=o>*</span><span class=p>)</span> <span class=n>palette_black</span><span class=p>,</span> <span class=mi>32</span><span class=p>);</span>

    <span class=c1>//Indice para pdoer saber la carga</span>
    <span class=n>u16</span> <span class=n>ind</span> <span class=o>=</span> <span class=n>TILE_USERINDEX</span><span class=p>;</span>

    <span class=c1>//dibuja un plano a partir de un recurso</span>
    <span class=n>VDP_drawImageEx</span><span class=p>(</span><span class=n>BG_B</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>bga_image</span><span class=p>,</span> <span class=n>TILE_ATTR_FULL</span><span class=p>(</span><span class=n>PAL1</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>ind</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>TRUE</span><span class=p>);</span>
    <span class=n>ind</span> <span class=o>+=</span> <span class=n>bga_image</span><span class=p>.</span><span class=n>tileset</span><span class=o>-&gt;</span><span class=n>numTile</span><span class=p>;</span>
    <span class=n>VDP_drawImageEx</span><span class=p>(</span><span class=n>BG_A</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>bgb_image</span><span class=p>,</span> <span class=n>TILE_ATTR_FULL</span><span class=p>(</span><span class=n>PAL0</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>ind</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>TRUE</span><span class=p>);</span>
    <span class=n>ind</span> <span class=o>+=</span> <span class=n>bgb_image</span><span class=p>.</span><span class=n>tileset</span><span class=o>-&gt;</span><span class=n>numTile</span><span class=p>;</span>



     <span class=c1>//Se vuelven a activar las interrupciones</span>
    <span class=n>SYS_enableInts</span><span class=p>();</span>
     <span class=c1>//Inicializa motor de sprites con los parámetros por defecto</span>
    <span class=n>SPR_init</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>

    <span class=n>mainsprt</span> <span class=o>=</span> <span class=n>SPR_addSprite</span><span class=p>(</span><span class=o>&amp;</span><span class=n>main_sprt</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>125</span><span class=p>,</span> <span class=n>TILE_ATTR_FULL</span><span class=p>(</span><span class=n>PAL2</span><span class=p>,</span> <span class=n>TRUE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span><span class=n>ind</span><span class=p>));</span>
    <span class=n>secondsprt</span><span class=o>=</span> <span class=n>SPR_addSprite</span><span class=p>(</span><span class=o>&amp;</span><span class=n>elli_sprt</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>155</span><span class=p>,</span> <span class=n>TILE_ATTR</span><span class=p>(</span><span class=n>PAL3</span><span class=p>,</span><span class=n>TRUE</span><span class=p>,</span><span class=n>FALSE</span><span class=p>,</span><span class=n>FALSE</span><span class=p>));</span>
    <span class=c1>// prepare palettes</span>
    <span class=n>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>palette</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>bgb_image</span><span class=p>.</span><span class=n>palette</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>,</span> <span class=mi>16</span> <span class=o>*</span> <span class=mi>2</span><span class=p>);</span>
    <span class=n>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>palette</span><span class=p>[</span><span class=mi>16</span><span class=p>],</span> <span class=n>bga_image</span><span class=p>.</span><span class=n>palette</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>,</span> <span class=mi>16</span> <span class=o>*</span> <span class=mi>2</span><span class=p>);</span>
    <span class=n>VDP_setPalette</span><span class=p>(</span><span class=n>PAL2</span><span class=p>,</span><span class=n>main_sprt</span><span class=p>.</span><span class=n>palette</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>);</span>
    <span class=n>VDP_setPalette</span><span class=p>(</span><span class=n>PAL3</span><span class=p>,</span> <span class=n>elli_sprt</span><span class=p>.</span><span class=n>palette</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>);</span>
    <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>mainsprt</span><span class=p>,</span> <span class=n>ANIM_STAY</span><span class=p>);</span>
    <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span> <span class=n>ANIM_STAY</span><span class=p>);</span>
     <span class=c1>// fade in</span>
    <span class=n>VDP_fadeIn</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>palette</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>);</span>
    <span class=c1>// bucle infinito</span>
    <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>

        <span class=n>readcontrollers</span><span class=p>();</span>
        <span class=c1>//actualiza el VDP</span>
        <span class=n>SPR_update</span><span class=p>();</span>
        <span class=c1>//Esperar refresco</span>
        <span class=n>VDP_waitVSync</span><span class=p>();</span>
    <span class=p>}</span>

<span class=p>}</span>

<span class=kt>void</span> <span class=nf>readcontrollers</span><span class=p>()</span>
<span class=p>{</span>
    <span class=c1>//Se lee el estado del joistick en el puerto 1</span>
    <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=n>JOY_readJoypad</span><span class=p>(</span><span class=n>JOY_1</span><span class=p>);</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_RIGHT</span><span class=p>){</span>
        <span class=n>SPR_setPosition</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span> <span class=n>posx</span><span class=o>++</span><span class=p>,</span> <span class=n>posy</span><span class=p>);</span>
        <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span><span class=n>ANIM_RIGTH</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_LEFT</span><span class=p>){</span>
        <span class=n>SPR_setPosition</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span> <span class=n>posx</span><span class=o>--</span><span class=p>,</span> <span class=n>posy</span><span class=p>);</span>
        <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span><span class=n>ANIM_LEFT</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_DOWN</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>SPR_setPosition</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span> <span class=n>posx</span><span class=p>,</span> <span class=n>posy</span><span class=o>++</span><span class=p>);</span>
        <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span><span class=n>ANIM_DOWN</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>if</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_UP</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>SPR_setPosition</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span> <span class=n>posx</span><span class=p>,</span> <span class=n>posy</span><span class=o>--</span><span class=p>);</span>
        <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span><span class=n>ANIM_UP</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span><span class=p>(((</span><span class=o>!</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_RIGHT</span><span class=p>))</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_LEFT</span><span class=p>)))</span> <span class=o>&amp;&amp;</span> <span class=p>((</span><span class=o>!</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_DOWN</span><span class=p>))</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=n>BUTTON_UP</span><span class=p>))))</span>
    <span class=p>{</span>
        <span class=n>SPR_setAnim</span><span class=p>(</span><span class=n>secondsprt</span><span class=p>,</span><span class=n>ANIM_STAY</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p><strong>RECUERDA:</strong> Debes crear el fichero .res con la información tanto de los sprites, como de los fondos; fijate en el código fuente para saber el nombre de los recursos.</p> </div> <p>Si ejecutamos el juego en un emulador, se mostrara mas o menos asi:</p> <p><img alt=spritesrom src=../../img/spritesrom.png></p> <p>Ya tenemos nuestro juego casi finalizado; ya solo nos falta añadir sonido y música.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../planes/ title=Planos class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Anterior </span> Planos </span> </div> </a> <a href=../sound-music/ title="Musica y sonido" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Siguiente </span> Musica y sonido </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 <a href=https://twitter.com/zerasul>Zerasul</a> <img alt="Licencia de Creative Commons" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/80x15.png> </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/HackLab-Almeria class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/HackLabAl class="md-footer-social__link fa fa-twitter"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.245445c6.js></script> <script src=../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../assets/javascripts/lunr/lunr.es.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>